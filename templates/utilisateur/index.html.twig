{% extends 'base.html.twig' %}

{% block title %}Tableau de Bord - Collab√âpargne{% endblock %}

{% block body %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/utilisateur.css') }}">
{% endblock %}
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">Collab<span>√âpargne</span></div>
            <div class="user-info">
                <img src="{{ asset('image/profile.png') }}" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">{{ app.user.nom }} {{ app.user.prenom }}</div>
                    <div class="user-status">Membre actif</div>
                </div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item active">
                <span class="menu-icon">üè†</span>
                <span><a href="{{ path('app_utilisateur') }}">Tableau de bord</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">‚ûï</span>
                <span><a href="{{ path('app_creation_cotisation') }}" style="color: #fff; text-decoration: none;">Cr√©er une cotisation</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üë•</span>
                <span><a href="#" style="color: #fff; text-decoration: none;">Mes cotisations</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üí∞</span>
                <span><a href="#" style="color: #fff; text-decoration: none;">Mes √©pargnes</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üìä</span>
                <span><a href="#" style="color: #fff; text-decoration: none;">Historique des contributions</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üìÖ</span>
                <span><a href="{{ path('app_echeance') }}" style="color: #fff; text-decoration: none;">√âch√©ances</a></span>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="sidebar-menu-item">
                <span class="menu-icon">üö™</span>
                <span><a href="{{ path('app_logout') }}" class="btn btn-danger">D√©connexion</a></span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
            <h1 class="page-title">Tableau de bord</h1>
            <div class="action-buttons">
                <a href="{{ path('app_utilisateur') }}" class="btn btn-outline">
                    <span class="btn-icon">üîÑ</span>
                    Actualiser
                </a>
                <button class="btn btn-primary">
                    <span class="btn-icon">‚ûï</span>
                    <a href="{{ path('app_creation_cotisation') }}" style="color: #fff; text-decoration: none;">
                    Cr√©er une cotisation
                    </a>
                </button>
            </div>
        </div>
        
        <!-- Mobile Action Buttons -->
        <div class="mobile-actions" style="display: none;">
            <a href="{{ path('app_creation_cotisation') }}" style="width: 100%; text-decoration: none;">
                <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                    <span class="btn-icon">‚ûï</span>
                    Cr√©er une cotisation
                </button>
            </a>
        </div>
        
        <!-- Dashboard Summary Cards -->
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Mes cotisations</div>
                    </div>
                    <div class="card-icon primary">üë•</div>
                </div>
                <div class="card-value">
                    {% if cotisations is defined %}
                        {{ cotisations|length }}
                    {% else %}
                        0
                    {% endif %}
                </div>
                <div class="card-subtitle">Groupes d'√©pargne</div>
                <div class="card-footer">
                    {% if nouvelles_cotisations is defined and nouvelles_cotisations > 0 %}
                        <span class="trend-up">‚Üë {{ nouvelles_cotisations }} </span>
                        <span>depuis le mois dernier</span>
                    {% else %}
                        <span>Aucune nouvelle cotisation</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">√âpargne totale</div>
                    </div>
                    <div class="card-icon success">üí∞</div>
                </div>
                <div class="card-value">
                    {% if epargne_totale is defined %}
                        {{ epargne_totale|number_format(0, ',', ' ') }} FCFA
                    {% else %}
                        0 FCFA
                    {% endif %}
                </div>
                <div class="card-subtitle">Toutes cotisations confondues</div>
                <div class="card-footer">
                    {% if evolution_epargne is defined and evolution_epargne > 0 %}
                        <span class="trend-up">‚Üë {{ evolution_epargne|number_format(0, ',', ' ') }} FCFA </span>
                        <span>depuis le mois dernier</span>
                    {% elseif evolution_epargne is defined and evolution_epargne < 0 %}
                        <span class="trend-down">‚Üì {{ (evolution_epargne * -1)|number_format(0, ',', ' ') }} FCFA </span>
                        <span>depuis le mois dernier</span>
                    {% else %}
                        <span>Stable depuis le mois dernier</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Prochain versement</div>
                    </div>
                    <div class="card-icon warning">üìÖ</div>
                </div>
                {% if prochain_versement is defined and prochain_versement %}
                    <div class="card-value">{{ prochain_versement.montant|number_format(0, ',', ' ') }} FCFA</div>
                    <div class="card-subtitle">√âch√©ance: {{ prochain_versement.date|date('d F Y') }}</div>
                    <div class="card-footer">
                        <span>Dans {{ prochain_versement.jours_restants }} jours</span>
                    </div>
                {% else %}
                    <div class="card-value">0 FCFA</div>
                    <div class="card-subtitle">Aucun versement pr√©vu</div>
                    <div class="card-footer">
                        <span>Vous n'avez pas d'√©ch√©ance programm√©e</span>
                    </div>
                {% endif %}
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Objectif principal</div>
                    </div>
                    <div class="card-icon danger">üéØ</div>
                </div>
                {% if objectif_principal is defined and objectif_principal %}
                    <div class="card-value">{{ objectif_principal.progression }}%</div>
                    <div class="card-subtitle">{{ objectif_principal.nom }} - {{ objectif_principal.montant_actuel|number_format(0, ',', ' ') }} FCFA/{{ objectif_principal.montant_objectif|number_format(0, ',', ' ') }} FCFA</div>
                    <div class="card-footer">
                        {% if objectif_principal.evolution > 0 %}
                            <span class="trend-up">‚Üë {{ objectif_principal.evolution }}% </span>
                            <span>ce mois-ci</span>
                        {% else %}
                            <span>Stable ce mois-ci</span>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="card-value">0%</div>
                    <div class="card-subtitle">Aucun objectif d√©fini</div>
                    <div class="card-footer">
                        <span>Cr√©ez une cotisation pour d√©finir un objectif</span>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Mes groupes d'√©pargne -->
        <div class="section-title">
            <h2>Mes groupes de cotisation</h2>
            <a href="#" class="view-all">Voir toutes mes cotisations ‚Üí</a>
        </div>
        
        <div class="table-container">
            {% if cotisations is defined and cotisations is empty %}
                <div class="empty-state">
                    <p>Vous ne participez √† aucun groupe de cotisation pour le moment.</p>
                    <a href="{{ path('app_creation_cotisation') }}" class="btn btn-primary empty-action">
                        <span class="btn-icon">‚ûï</span> Cr√©er une cotisation
                    </a>
                    <a href="{{ path('app_cotisations_disponibles') }}" class="btn btn-outline empty-action">
                        <span class="btn-icon">üîç</span> Voir les cotisations disponibles
                    </a>
                </div>
            {% elseif cotisations is defined %}
                <table>
                    <thead>
                        <tr>
                            <th>Nom du groupe</th>
                            <th>Membres</th>
                            <th>Objectif</th>
                            <th>Progression</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cotisation in cotisations|slice(0, 3) %}
                            <tr>
                                <td>{{ cotisation.nom }}</td>
                                <td>{{ cotisation.membres|length }} membres</td>
                                <td>{{ cotisation.montant_objectif|number_format(0, ',', ' ') }} FCFA</td>
                                <td>{{ cotisation.montant_actuel|number_format(0, ',', ' ') }} FCFA ({{ cotisation.progression }}%)</td>
                                <td>
                                    {% if cotisation.statut == 'actif' %}
                                        <span class="status status-active">Actif</span>
                                    {% elseif cotisation.statut == 'compl√©t√©' %}
                                        <span class="status status-completed">Compl√©t√©</span>
                                    {% elseif cotisation.statut == 'attente' %}
                                        <span class="status status-pending">En attente</span>
                                    {% endif %}
                                </td>
                                <td class="action-cell">
                                    <a href="{{ path('app_detail_cotisation', {'id': cotisation.id}) }}" class="action-btn" title="D√©tails">üëÅÔ∏è</a>
                                    {% if app.user.id == cotisation.createur_id %}
                                        <a href="{{ path('app_gestion_cotisation', {'id': cotisation.id}) }}" class="action-btn" title="G√©rer">‚öôÔ∏è</a>
                                    {% endif %}
                                    <a href="{{ path('app_faire_depot', {'id': cotisation.id}) }}" class="action-btn" title="Faire un d√©p√¥t">üí∞</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
        
        <!-- Historique r√©cent -->
        <div class="section-title">
            <h2>Activit√©s r√©centes</h2>
            <a href="#" class="view-all">Voir l'historique complet ‚Üí</a>
        </div>
        
        <div class="table-container">
            {% if activites is defined and activites is empty %}
                <div class="empty-state">
                    <p>Aucune activit√© r√©cente √† afficher.</p>
                </div>
            {% elseif activites is defined %}
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Groupe</th>
                            <th>Montant</th>
                            <th>Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activite in activites|slice(0, 5) %}
                            <tr>
                                <td>{{ activite.date|date('d/m/Y') }}</td>
                                <td>{{ activite.type }}</td>
                                <td>{{ activite.cotisation }}</td>
                                <td>{% if activite.montant %}{{ activite.montant|number_format(0, ',', ' ') }} FCFA{% else %}‚Äî{% endif %}</td>
                                <td>
                                    {% if activite.statut == 'confirm√©' %}
                                        <span class="status status-completed">Confirm√©</span>
                                    {% elseif activite.statut == 'en attente' %}
                                        <span class="status status-pending">En attente</span>
                                    {% elseif activite.statut == 'refus√©' %}
                                        <span class="status status-danger">Refus√©</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
        
        <!-- Invitations en attente -->
        {% if invitations is defined and invitations is not empty %}
            <div class="section-title">
                <h2>Invitations en attente</h2>
                <a href="#" class="view-all">Voir toutes les invitations ‚Üí</a>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Groupe</th>
                            <th>Cr√©ateur</th>
                            <th>Objectif</th>
                            <th>Date d'invitation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for invitation in invitations|slice(0, 3) %}
                            <tr>
                                <td>{{ invitation.cotisation.nom }}</td>
                                <td>{{ invitation.createur.nom }} {{ invitation.createur.prenom }}</td>
                                <td>{{ invitation.cotisation.montant_objectif|number_format(0, ',', ' ') }} FCFA</td>
                                <td>{{ invitation.date|date('d/m/Y') }}</td>
                                <td class="action-cell">
                                    <a href="{{ path('app_accepter_invitation', {'id': invitation.id}) }}" class="btn btn-sm btn-success">Accepter</a>
                                    <a href="{{ path('app_refuser_invitation', {'id': invitation.id}) }}" class="btn btn-sm btn-outline-danger">Refuser</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
    
    <script src="{{ asset('js/utilisateur.js') }}"></script>
{% endblock %}