{% extends 'base.html.twig' %}

{% block title %}Cr√©er une cotisation - Collab√âpargne{% endblock %}

{% block body %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/cotisation.css') }}">
{% endblock %}
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">Collab<span>√âpargne</span></div>
            <div class="user-info">
                <img src="{{ asset('image/profile.png') }}" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">{{ app.user.nom }} {{ app.user.prenom }}</div>
                    <div class="user-status">Membre actif</div>
                </div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item">
                <span class="menu-icon">üè†</span>
                <span><a href="{{ path('app_utilisateur') }}">Tableau de bord</a></span>
            </li>
            <li class="sidebar-menu-item active">
                <span class="menu-icon">‚ûï</span>
                <span><a href="{{ path('app_creation_cotisation') }}">Cr√©er une cotisation</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üë•</span>
                <span><a href="#">Mes cotisations</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üìä</span>
                <span><a href="#">Historique des contributions</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üìÖ</span>
                <span><a href="{{ path('app_echeance') }}">√âch√©ances</a></span>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="sidebar-menu-item">
                <span class="menu-icon">üö™</span>
                <span><a href="{{ path('app_logout') }}" class="btn btn-danger">D√©connexion</a></span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
            <h1 class="page-title">Cr√©er une cotisation</h1>
            <div class="action-buttons">
                <a href="{{ path('app_utilisateur') }}" class="btn btn-outline">
                    <span class="btn-icon">‚Ü©Ô∏è</span>
                    Retour au tableau de bord
                </a>
            </div>
        </div>
        
        <!-- Mobile Action Buttons -->
        <div class="mobile-actions" style="display: none;">
            <a href="{{ path('app_utilisateur') }}" style="width: 100%; text-decoration: none;">
                <button class="btn btn-outline" style="width: 100%; margin-bottom: 1rem;">
                    <span class="btn-icon">‚Ü©Ô∏è</span>
                    Retour au tableau de bord
                </button>
            </a>
        </div>
        
        <!-- Form Container -->
        <div class="form-container">
            <form method="post" action="{{ path('app_creation_cotisation') }}" class="create-form">
                <div class="form-section">
                    <h2>Informations g√©n√©rales</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="titre">Titre de la cotisation <span class="required">*</span></label>
                            <input type="text" id="titre" name="titre" required placeholder="Ex: Voyage au Maroc, Cadeau d'anniversaire...">
                        </div>
                        
                        <div class="form-group">
                            <label for="typeCotisation">Type de cotisation <span class="required">*</span></label>
                            <select id="typeCotisation" name="typeCotisation" required>
                                <option value="periodique" selected>P√©riodique - Cotisations r√©guli√®res avec un montant fixe</option>
                                <option value="souscription">Souscription - Contributions libres avec un montant minimum</option>
                            </select>
                        </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" rows="4" placeholder="D√©crivez l'objectif de cette cotisation, comment les fonds seront utilis√©s..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="montantObjectif">Montant objectif (FCFA) <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <input type="number" id="montantObjectif" name="montantObjectif" min="1" required placeholder="Ex: 500000">
                                <span class="input-icon">FCFA</span>
                            </div>
                            <small class="form-helper">Montant total √† atteindre pour cette cotisation</small>
                        </div>
                        
                        <div class="form-group" id="montantEcheanceGroup">
                            <label for="montantEcheance">Montant par √©ch√©ance (FCFA) <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <input type="number" id="montantEcheance" name="montantEcheance" min="1" required placeholder="Ex: 25000">
                                <span class="input-icon">FCFA</span>
                            </div>
                            <small class="form-helper">Montant √† verser √† chaque p√©riode</small>
                        </div>
                        
                        <div class="form-group" id="montantMinimumGroup" style="display: none;">
                            <label for="montantMinimum">Montant minimum (FCFA) <span class="required">*</span></label>
                            <div class="input-with-icon">
                                <input type="number" id="montantMinimum" name="montantMinimum" min="1" required placeholder="Ex: 10000">
                                <span class="input-icon">FCFA</span>
                            </div>
                            <small class="form-helper">Montant minimum accept√© par contribution</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-section" id="periodeSection">
                    <h2>P√©riode de cotisation</h2>
                    <div class="form-row date-row">
                        <div class="form-group">
                            <label for="dateDebut">Date de d√©but <span class="required">*</span></label>
                            <input type="date" id="dateDebut" name="dateDebut" required>
                            <small class="form-helper">Date √† laquelle la cotisation commence</small>
                        </div>
                        
                        <div class="form-group date-fin-group">
                            <label for="dateFin">Date de fin</label>
                            <div class="date-fin-container">
                                <input type="date" id="dateFin" name="dateFin">
                                <div class="checkbox-container">
                                    <input type="checkbox" id="sansDateFin" name="sansDateFin">
                                    <label for="sansDateFin">Pas de date de fin</label>
                                </div>
                            </div>
                            <small class="form-helper">Date √† laquelle la cotisation se termine</small>
                        </div>
                    </div>
                    
                    <div class="form-row period-options" id="periodOptions">
                        <div class="form-group">
                            <label for="periodicite">P√©riodicit√© <span class="required">*</span></label>
                            <select id="periodicite" name="periodicite" required>
                                <option value="journalier">Journalier</option>
                                <option value="hebdomadaire">Hebdomadaire</option>
                                <option value="mensuel" selected>Mensuel</option>
                            </select>
                            <small class="form-helper">√Ä quelle fr√©quence les cotisations sont collect√©es</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="frequence">Fr√©quence de p√©riode <span class="required">*</span></label>
                            <select id="frequence" name="frequence" required>
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <small class="form-helper">Nombre de p√©riodes entre chaque collecte</small>
                        </div>
                    </div>
                    
                    <div class="form-info" id="frequenceExplication">
                        <div class="info-icon">‚ÑπÔ∏è</div>
                        <div class="info-text">Vous avez s√©lectionn√© une cotisation <strong><span class="frequency-type">mensuelle</span></strong> tous les <strong><span class="frequency-value">1</span> <span class="frequency-unit">mois</span></strong>.</div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="location.href='{{ path('app_utilisateur') }}'">Annuler</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-icon">‚úì</span>
                        Cr√©er la cotisation
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Initialiser la date du jour
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const formattedDate = today.toISOString().substr(0, 10);
            document.getElementById('dateDebut').value = formattedDate;
            
            // Calculer date par d√©faut pour la fin (aujourd'hui + 3 mois)
            const nextMonth = new Date();
            nextMonth.setMonth(nextMonth.getMonth() + 3);
            const formattedNextMonth = nextMonth.toISOString().substr(0, 10);
            document.getElementById('dateFin').value = formattedNextMonth;
            
            // Initialiser l'explication de fr√©quence
            updateFrequenceExplication();
            
            // S'assurer que tous les champs required sont correctement d√©finis
            toggleRequiredFields();
        });
        
        // Toggle sidebar on mobile
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
        
        // Mobile detection for responsive UI
        function checkMobile() {
            if (window.innerWidth <= 768) {
                document.querySelector('.mobile-actions').style.display = 'block';
                document.querySelector('.action-buttons').style.display = 'none';
            } else {
                document.querySelector('.mobile-actions').style.display = 'none';
                document.querySelector('.action-buttons').style.display = 'flex';
            }
        }
        
        // Check on load and resize
        window.addEventListener('load', checkMobile);
        window.addEventListener('resize', checkMobile);
        
        // Toggle type de cotisation
       // Event listener pour le changement de type de cotisation
document.getElementById('typeCotisation').addEventListener('change', function() {
    const type = this.value;
    
    // Afficher/masquer les champs en fonction du type
    if (type === 'periodique') {
        document.getElementById('montantEcheanceGroup').style.display = 'block';
        document.getElementById('montantMinimumGroup').style.display = 'none';
        document.getElementById('periodOptions').style.display = 'flex';
        document.getElementById('frequenceExplication').style.display = 'flex';
        document.getElementById('periodeSection').classList.remove('souscription-mode');
    } else {
        document.getElementById('montantEcheanceGroup').style.display = 'none';
        document.getElementById('montantMinimumGroup').style.display = 'block';
        document.getElementById('periodOptions').style.display = 'none';
        document.getElementById('frequenceExplication').style.display = 'none';
        document.getElementById('periodeSection').classList.add('souscription-mode');
    }
    
    // Mettre √† jour les champs requis
    toggleRequiredFields();
});

        // Fonction pour mettre √† jour les champs requis
function toggleRequiredFields() {
    const type = document.getElementById('typeCotisation').value;
    
    if (type === 'periodique') {
        document.getElementById('montantEcheance').required = true;
        document.getElementById('montantMinimum').required = false;
    } else {
        document.getElementById('montantEcheance').required = false;
        document.getElementById('montantMinimum').required = true;
    }
}
        
        // G√©rer la case √† cocher "Pas de date de fin"
        document.getElementById('sansDateFin').addEventListener('change', function() {
            const dateFin = document.getElementById('dateFin');
            if (this.checked) {
                dateFin.disabled = true;
                dateFin.classList.add('disabled');
                dateFin.value = '';
                dateFin.required = false;
            } else {
                dateFin.disabled = false;
                dateFin.classList.remove('disabled');
                dateFin.required = false;
                // R√©initialiser √† date par d√©faut (aujourd'hui + 3 mois)
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 3);
                dateFin.value = nextMonth.toISOString().substr(0, 10);
            }
        });
        
        // Mettre √† jour l'explication de fr√©quence
        function updateFrequenceExplication() {
            const periodicite = document.getElementById('periodicite').value;
            const frequence = document.getElementById('frequence').value;
            
            let typeText, unitText;
            
            switch(periodicite) {
                case 'journalier':
                    typeText = 'journali√®re';
                    unitText = frequence > 1 ? 'jours' : 'jour';
                    break;
                case 'hebdomadaire':
                    typeText = 'hebdomadaire';
                    unitText = frequence > 1 ? 'semaines' : 'semaine';
                    break;
                case 'mensuel':
                    typeText = 'mensuelle';
                    unitText = frequence > 1 ? 'mois' : 'mois';
                    break;
                default:
                    typeText = 'personnalis√©e';
                    unitText = 'p√©riode(s)';
            }
            
            document.querySelector('.frequency-type').textContent = typeText;
            document.querySelector('.frequency-value').textContent = frequence;
            document.querySelector('.frequency-unit').textContent = unitText;
        }
        
        // √âcouter les changements de p√©riodicit√© et de fr√©quence
        document.getElementById('periodicite').addEventListener('change', updateFrequenceExplication);
        document.getElementById('frequence').addEventListener('change', updateFrequenceExplication);
    </script>
{% endblock %}