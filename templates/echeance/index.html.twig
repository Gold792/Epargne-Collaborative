{% extends 'base.html.twig' %}

{% block title %}√âch√©ances - Collab√âpargne{% endblock %}

{% block body %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/echeance.css') }}">
{% endblock %}
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">Collab<span>√âpargne</span></div>
            <div class="user-info">
                <img src="{{ asset('image/profile.png') }}" alt="User" class="user-avatar">
                <div class="user-details">
                    <div class="user-name">Jean Dupont</div>
                    <div class="user-status">Membre actif</div>
                </div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li class="sidebar-menu-item">
                <span class="menu-icon">üè†</span>
                <span><a href="{{ path('app_utilisateur') }}">Tableau de bord</a></span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">‚ûï</span>
                <span>Cr√©er une cotisation</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üë•</span>
                <span>Mes cotisations</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üí∞</span>
                <span>√âpargnes</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üí∏</span>
                <span>Effectuer un d√©p√¥t</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üìä</span>
                <span>Historique des contributions</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">üéØ</span>
                <span>Objectifs</span>
            </li>
            <li class="sidebar-menu-item active">
                <span class="menu-icon">üìÖ</span>
                <span>√âch√©ances</span>
            </li>
            <li class="sidebar-menu-item">
                <span class="menu-icon">‚öôÔ∏è</span>
                <span>Param√®tres</span>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <div class="sidebar-menu-item">
                <span class="menu-icon">‚ùì</span>
                <span>Aide & Support</span>
            </div>
            <div class="sidebar-menu-item">
                <span class="menu-icon">üö™</span>
                <span><a href="{{ path('app_logout') }}" class="btn btn-danger">D√©connexion</a></span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <button class="sidebar-toggle" id="sidebar-toggle">‚ò∞</button>
            <h1 class="page-title">Gestion des √©ch√©ances</h1>
            <div class="action-buttons">
                <a href="#" class="btn btn-outline calendar-toggle">
                    <span class="btn-icon">üìÜ</span>
                    Vue calendrier
                </a>
                <a href="#" class="btn btn-primary" id="effectuerPaiementBtn">
                    <span class="btn-icon">üí≥</span>
                    Effectuer un paiement
                </a>
            </div>
        </div>
        
        <!-- Mobile Action Buttons -->
        <div class="mobile-actions" style="display: none;">
            <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                <span class="btn-icon">üí≥</span>
                Effectuer un paiement
            </button>
        </div>
        
        <!-- √âch√©ances status cards -->
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">√âch√©ances √† venir</div>
                    </div>
                    <div class="card-icon warning">üìÖ</div>
                </div>
                <div class="card-value">4</div>
                <div class="card-subtitle">Dans les 30 prochains jours</div>
                <div class="card-footer">
                    <span>Prochain paiement: 15 avril 2025</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">√âch√©ances en retard</div>
                    </div>
                    <div class="card-icon danger">‚ö†Ô∏è</div>
                </div>
                <div class="card-value">0</div>
                <div class="card-subtitle">Aucun retard de paiement</div>
                <div class="card-footer">
                    <span>Vous √™tes √† jour !</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Montant d√ª</div>
                    </div>
                    <div class="card-icon primary">üí∂</div>
                </div>
                <div class="card-value">450 ‚Ç¨</div>
                <div class="card-subtitle">Total √©ch√©ances √† venir</div>
                <div class="card-footer">
                    <span>Prochain montant: 150 ‚Ç¨</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">√âch√©ances compl√©t√©es</div>
                    </div>
                    <div class="card-icon success">‚úÖ</div>
                </div>
                <div class="card-value">12</div>
                <div class="card-subtitle">Ce trimestre</div>
                <div class="card-footer">
                    <span>Dernier paiement: 01/04/2025</span>
                </div>
            </div>
        </div>
        
        <!-- Filtres -->
        <div class="filters-container">
            <div class="filters">
                <div class="filter-group">
                    <label for="filter-cotisation">Cotisation</label>
                    <select id="filter-cotisation">
                        <option value="all">Toutes les cotisations</option>
                        <option value="1">Voyage √† Bali</option>
                        <option value="2">Fonds d'urgence</option>
                        <option value="3">Anniversaire Marie</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-status">Statut</label>
                    <select id="filter-status">
                        <option value="all">Tous les statuts</option>
                        <option value="pending">√Ä venir</option>
                        <option value="late">En retard</option>
                        <option value="paid">Pay√©es</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="filter-period">P√©riode</label>
                    <select id="filter-period">
                        <option value="30">30 prochains jours</option>
                        <option value="90">3 prochains mois</option>
                        <option value="180">6 prochains mois</option>
                        <option value="past">Historique</option>
                    </select>
                </div>
                
                <button class="btn btn-outline btn-sm">
                    <span class="btn-icon">üîÑ</span>
                    Rafra√Æchir
                </button>
            </div>
        </div>
        
        <!-- Vue liste -->
        <div class="table-container" id="list-view">
            <table>
                <thead>
                    <tr>
                        <th>Date d'√©ch√©ance</th>
                        <th>Cotisation</th>
                        <th>Montant</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>15/04/2025</td>
                        <td>Voyage √† Bali</td>
                        <td>150 ‚Ç¨</td>
                        <td><span class="status status-pending">√Ä venir</span></td>
                        <td class="action-cell">
                            <button class="btn btn-primary btn-sm pay-now">Payer</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                    <tr>
                        <td>20/04/2025</td>
                        <td>Fonds d'urgence</td>
                        <td>200 ‚Ç¨</td>
                        <td><span class="status status-pending">√Ä venir</span></td>
                        <td class="action-cell">
                            <button class="btn btn-primary btn-sm pay-now">Payer</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                    <tr>
                        <td>01/04/2025</td>
                        <td>Voyage √† Bali</td>
                        <td>150 ‚Ç¨</td>
                        <td><span class="status status-completed">Pay√©e</span></td>
                        <td class="action-cell">
                            <button class="btn btn-outline btn-sm">Re√ßu</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                    <tr>
                        <td>15/05/2025</td>
                        <td>Voyage √† Bali</td>
                        <td>150 ‚Ç¨</td>
                        <td><span class="status status-pending">√Ä venir</span></td>
                        <td class="action-cell">
                            <button class="btn btn-primary btn-sm pay-now">Payer</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                    <tr>
                        <td>23/03/2025</td>
                        <td>Fonds d'urgence</td>
                        <td>200 ‚Ç¨</td>
                        <td><span class="status status-completed">Pay√©e</span></td>
                        <td class="action-cell">
                            <button class="btn btn-outline btn-sm">Re√ßu</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                    <tr>
                        <td>15/06/2025</td>
                        <td>Voyage √† Bali</td>
                        <td>150 ‚Ç¨</td>
                        <td><span class="status status-pending">√Ä venir</span></td>
                        <td class="action-cell">
                            <button class="btn btn-primary btn-sm pay-now">Payer</button>
                            <button class="action-btn">üìù</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Vue calendrier (masqu√©e par d√©faut) -->
        <div class="calendar-container" id="calendar-view" style="display: none;">
            <div class="calendar-header">
                <button class="btn btn-outline btn-sm" id="prev-month">‚óÄ</button>
                <h2 id="current-month">Avril 2025</h2>
                <button class="btn btn-outline btn-sm" id="next-month">‚ñ∂</button>
            </div>
            <div class="calendar">
                <div class="calendar-weekdays">
                    <div>Lun</div>
                    <div>Mar</div>
                    <div>Mer</div>
                    <div>Jeu</div>
                    <div>Ven</div>
                    <div>Sam</div>
                    <div>Dim</div>
                </div>
                <div class="calendar-days">
                    <!-- Days will be generated by JavaScript -->
                </div>
            </div>
            <div class="calendar-legend">
                <div class="legend-item">
                    <div class="legend-color payment-due"></div>
                    <span>√âch√©ance √† venir</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color payment-paid"></div>
                    <span>√âch√©ance pay√©e</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color payment-late"></div>
                    <span>√âch√©ance en retard</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de paiement -->
    <div class="modal" id="payment-modal">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h2>Effectuer un paiement</h2>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="payment-form">
                    <div class="form-group">
                        <label for="payment-cotisation">Cotisation</label>
                        <select id="payment-cotisation" required>
                            <option value="">S√©lectionner une cotisation</option>
                            <option value="1">Voyage √† Bali (√©ch√©ance: 15/04/2025)</option>
                            <option value="2">Fonds d'urgence (√©ch√©ance: 20/04/2025)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-amount">Montant (‚Ç¨)</label>
                        <input type="number" id="payment-amount" required min="1" value="150">
                    </div>
                    
                    <div class="form-group">
                        <label for="payment-method">M√©thode de paiement</label>
                        <select id="payment-method" required>
                            <option value="">S√©lectionner une m√©thode</option>
                            <option value="card">Carte bancaire</option>
                            <option value="mobile">Mobile Money</option>
                        </select>
                    </div>
                    
                    <div id="card-payment-details" style="display: none;">
                        <div class="form-group">
                            <label for="card-number">Num√©ro de carte</label>
                            <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="card-expiry">Date d'expiration</label>
                                <input type="text" id="card-expiry" placeholder="MM/AA">
                            </div>
                            
                            <div class="form-group">
                                <label for="card-cvv">CVV</label>
                                <input type="text" id="card-cvv" placeholder="123" maxlength="3">
                            </div>
                        </div>
                    </div>
                    
                    <div id="mobile-payment-details" style="display: none;">
                        <div class="form-group">
                            <label for="mobile-number">Num√©ro de t√©l√©phone</label>
                            <input type="tel" id="mobile-number" placeholder="+XX XXXXXXXXX">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Annuler</button>
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">‚úì</span>
                            Confirmer le paiement
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Toggle sidebar on mobile
        document.getElementById('sidebar-toggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
        
        // Toggle between list and calendar views
        document.querySelector('.calendar-toggle').addEventListener('click', function(e) {
            e.preventDefault();
            const listView = document.getElementById('list-view');
            const calendarView = document.getElementById('calendar-view');
            
            if (listView.style.display !== 'none') {
                listView.style.display = 'none';
                calendarView.style.display = 'block';
                this.innerHTML = '<span class="btn-icon">üìã</span> Vue liste';
                generateCalendar();
            } else {
                listView.style.display = 'block';
                calendarView.style.display = 'none';
                this.innerHTML = '<span class="btn-icon">üìÜ</span> Vue calendrier';
            }
        });
        
        // Payment modal
        const modal = document.getElementById('payment-modal');
        const modalOverlay = document.querySelector('.modal-overlay');
        const openModalBtn = document.getElementById('effectuerPaiementBtn');
        const closeModalBtns = document.querySelectorAll('.modal-close');
        const payNowBtns = document.querySelectorAll('.pay-now');
        
        openModalBtn.addEventListener('click', function(e) {
            e.preventDefault();
            modal.classList.add('active');
        });
        
        payNowBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                modal.classList.add('active');
            });
        });
        
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                modal.classList.remove('active');
            });
        });
        
        modalOverlay.addEventListener('click', function() {
            modal.classList.remove('active');
        });
        
        // Payment method toggle
        document.getElementById('payment-method').addEventListener('change', function() {
            const cardDetails = document.getElementById('card-payment-details');
            const mobileDetails = document.getElementById('mobile-payment-details');
            
            if (this.value === 'card') {
                cardDetails.style.display = 'block';
                mobileDetails.style.display = 'none';
            } else if (this.value === 'mobile') {
                cardDetails.style.display = 'none';
                mobileDetails.style.display = 'block';
            } else {
                cardDetails.style.display = 'none';
                mobileDetails.style.display = 'none';
            }
        });
        
        // Generate calendar
        function generateCalendar() {
            const calendarDays = document.querySelector('.calendar-days');
            calendarDays.innerHTML = '';
            
            // Example data - this would normally come from your backend
            const paymentDates = {
                '2025-04-01': { status: 'paid', cotisation: 'Voyage √† Bali', amount: '150 ‚Ç¨' },
                '2025-04-15': { status: 'due', cotisation: 'Voyage √† Bali', amount: '150 ‚Ç¨' },
                '2025-04-20': { status: 'due', cotisation: 'Fonds d\'urgence', amount: '200 ‚Ç¨' },
                '2025-05-15': { status: 'due', cotisation: 'Voyage √† Bali', amount: '150 ‚Ç¨' },
                '2025-03-23': { status: 'paid', cotisation: 'Fonds d\'urgence', amount: '200 ‚Ç¨' }
            };
            
            // Get current date
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Update month display
            const monthNames = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 
                              'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Get first day of month and last day
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Adjust for Monday as first day of week
            const startingDay = firstDay === 0 ? 6 : firstDay - 1;
            
            // Create empty cells for days before start of month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarDays.appendChild(emptyDay);
            }
            
            // Create cells for days in month
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // Current day
                const currentDate = new Date();
                if (i === currentDate.getDate() && 
                    currentMonth === currentDate.getMonth() && 
                    currentYear === currentDate.getFullYear()) {
                    dayCell.classList.add('today');
                }
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = i;
                dayCell.appendChild(dayNumber);
                
                // Check if there are payments on this day
                const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                if (paymentDates[dateString]) {
                    const payment = paymentDates[dateString];
                    
                    // Add payment indicator
                    const paymentIndicator = document.createElement('div');
                    paymentIndicator.className = `payment-indicator payment-${payment.status}`;
                    
                    // Add payment details
                    const paymentDetails = document.createElement('div');
                    paymentDetails.className = 'payment-details';
                    paymentDetails.innerHTML = `
                        <div class="payment-name">${payment.cotisation}</div>
                        <div class="payment-amount">${payment.amount}</div>
                        <div class="payment-status">${payment.status === 'paid' ? 'Pay√©e' : '√Ä payer'}</div>
                    `;
                    
                    paymentIndicator.appendChild(paymentDetails);
                    dayCell.appendChild(paymentIndicator);
                    
                    // Add pay button for due payments
                    if (payment.status === 'due') {
                        const payButton = document.createElement('button');
                        payButton.className = 'btn btn-primary btn-xs pay-calendar';
                        payButton.textContent = 'Payer';
                        payButton.addEventListener('click', function() {
                            modal.classList.add('active');
                        });
                        dayCell.appendChild(payButton);
                    }
                }
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        // Handle calendar navigation
        document.getElementById('prev-month').addEventListener('click', function() {
            // Implement previous month navigation
            // This would update the calendar data and re-render
        });
        
        document.getElementById('next-month').addEventListener('click', function() {
            // Implement next month navigation
            // This would update the calendar data and re-render
        });
        
        // Form submission
        document.getElementById('payment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Paiement effectu√© avec succ√®s !');
            modal.classList.remove('active');
            
            // Here you would normally send the payment data to your server
        });
    </script>
    
   
{% endblock %}